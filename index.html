<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>The Bruzz 3D: Next Gen</title>
    <style> body { margin: 0; overflow: hidden; background: #000; } </style>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- 3D ENGINE SETUP ---
        function Game3D() {
            const mountRef = useRef(null);
            const [score, setScore] = useState({ us: 0, them: 0 });

            // Game State
            const gameState = useRef({
                players: [
                    { id: 0, x: 0, z: 15, team: 'us', role: 'PG', color: 0x3b82f6 },
                    { id: 1, x: -10, z: 5, team: 'us', role: 'SG', color: 0x3b82f6 },
                    { id: 5, x: 0, z: 10, team: 'them', role: 'DEF', color: 0xef4444 }
                ],
                ball: { x: 0, y: 2, z: 14, vx: 0, vy: 0, vz: 0, owner: 0, state: 'dribble' },
                keys: {}
            });

            useEffect(() => {
                // 1. SCENE & CAMERA
                const scene = new THREE.Scene();
                scene.background = new THREE.Color(0x111827); // Dark Night Sky
                scene.fog = new THREE.Fog(0x111827, 20, 100);

                const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
                camera.position.set(0, 25, 45); // TV Broadcast Angle
                camera.lookAt(0, 0, 0);

                const renderer = new THREE.WebGLRenderer({ antialias: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.shadowMap.enabled = true;
                mountRef.current.appendChild(renderer.domElement);

                // 2. LIGHTING (Stadium Lights)
                const ambient = new THREE.AmbientLight(0xffffff, 0.4);
                scene.add(ambient);

                const spotLight = new THREE.SpotLight(0xffffff, 1);
                spotLight.position.set(10, 40, 20);
                spotLight.castShadow = true;
                scene.add(spotLight);

                // 3. COURT (The "Wood")
                const courtGeo = new THREE.PlaneGeometry(50, 94); // NBA Dimensions scaled down
                const courtMat = new THREE.MeshStandardMaterial({ 
                    color: 0xd97736, 
                    roughness: 0.2,
                    metalness: 0.1 
                });
                const court = new THREE.Mesh(courtGeo, courtMat);
                court.rotation.x = -Math.PI / 2;
                court.receiveShadow = true;
                scene.add(court);

                // Paint Lines (Simple Visuals)
                const paintGeo = new THREE.PlaneGeometry(16, 19);
                const paintMat = new THREE.MeshBasicMaterial({ color: 0x1e3a8a }); // Blue Paint
                const paint = new THREE.Mesh(paintGeo, paintMat);
                paint.rotation.x = -Math.PI / 2;
                paint.position.set(0, 0.01, 35); // Under hoop
                scene.add(paint);

                // 4. THE HOOP
                const poleGeo = new THREE.CylinderGeometry(0.5, 0.5, 15, 8);
                const poleMat = new THREE.MeshStandardMaterial({ color: 0x333333 });
                const pole = new THREE.Mesh(poleGeo, poleMat);
                pole.position.set(0, 7.5, 45);
                scene.add(pole);

                const backboardGeo = new THREE.BoxGeometry(6, 4, 0.2);
                const backboardMat = new THREE.MeshStandardMaterial({ color: 0xffffff, transparent: true, opacity: 0.8 });
                const backboard = new THREE.Mesh(backboardGeo, backboardMat);
                backboard.position.set(0, 13, 43);
                scene.add(backboard);

                const rimGeo = new THREE.TorusGeometry(1.5, 0.1, 8, 20);
                const rimMat = new THREE.MeshStandardMaterial({ color: 0xff4500 });
                const rim = new THREE.Mesh(rimGeo, rimMat);
                rim.rotation.x = Math.PI / 2;
                rim.position.set(0, 11, 41.5);
                scene.add(rim);

                // 5. PLAYERS & BALL (Meshes)
                const playerMeshes = [];
                const playerGeo = new THREE.CapsuleGeometry(1, 4, 4, 8); // Capsule shape = Human
                
                gameState.current.players.forEach(p => {
                    const mat = new THREE.MeshStandardMaterial({ color: p.color });
                    const mesh = new THREE.Mesh(playerGeo, mat);
                    mesh.position.set(p.x, 2, p.z);
                    mesh.castShadow = true;
                    scene.add(mesh);
                    playerMeshes.push({ mesh, data: p });
                });

                const ballGeo = new THREE.SphereGeometry(0.8, 16, 16);
                const ballMat = new THREE.MeshStandardMaterial({ color: 0xf97316, roughness: 0.4 });
                const ballMesh = new THREE.Mesh(ballGeo, ballMat);
                ballMesh.castShadow = true;
                scene.add(ballMesh);

                // --- CONTROLS ---
                const handleKeyDown = (e) => gameState.current.keys[e.key.toLowerCase()] = true;
                const handleKeyUp = (e) => gameState.current.keys[e.key.toLowerCase()] = false;
                window.addEventListener('keydown', handleKeyDown);
                window.addEventListener('keyup', handleKeyUp);

                // --- GAME LOOP ---
                const animate = () => {
                    requestAnimationFrame(animate);
                    const s = gameState.current;
                    const user = s.players[0];

                    // Movement Logic (WASD)
                    if(s.keys['w']) user.z -= 0.3;
                    if(s.keys['s']) user.z += 0.3;
                    if(s.keys['a']) user.x -= 0.3;
                    if(s.keys['d']) user.x += 0.3;

                    // Update Player Mesh Positions
                    playerMeshes.forEach(pm => {
                        pm.mesh.position.x = pm.data.x;
                        pm.mesh.position.z = pm.data.z;
                        
                        // Simple "Breathing" animation
                        pm.mesh.scale.y = 1 + Math.sin(Date.now() * 0.005) * 0.02;
                    });

                    // Ball Physics
                    if (s.ball.owner !== -1) {
                        // Dribbling
                        const owner = s.players[s.ball.owner];
                        s.ball.x = owner.x + 0.5;
                        s.ball.z = owner.z + 1.5;
                        // Bounce animation
                        s.ball.y = 2 + Math.abs(Math.sin(Date.now() * 0.01)) * 3; 
                    }

                    ballMesh.position.set(s.ball.x, s.ball.y, s.ball.z);

                    // Camera Follow
                    camera.position.x = user.x * 0.5; // Slight lag for cinematic feel
                    camera.lookAt(user.x, 5, user.z - 20);

                    renderer.render(scene, camera);
                };
                animate();

                return () => {
                    window.removeEventListener('keydown', handleKeyDown);
                    window.removeEventListener('keyup', handleKeyUp);
                    mountRef.current.removeChild(renderer.domElement);
                };
            }, []);

            return (
                <div style={{position: 'relative'}}>
                    <div ref={mountRef} />
                    <div style={{position: 'absolute', top: 20, left: 20, color: 'white', fontFamily: 'sans-serif', fontStyle: 'italic', fontWeight: '900', fontSize: '2rem', textShadow: '0 4px 10px black'}}>
                        THE BRUZZ <span style={{color: '#3b82f6'}}>3D</span>
                    </div>
                    <div style={{position: 'absolute', bottom: 20, left: 20, color: '#aaa', fontFamily: 'sans-serif'}}>
                        WASD to Move â€¢ 3D Engine v0.2
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Game3D />);
    </script>
</body>
</html>
