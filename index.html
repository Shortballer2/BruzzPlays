<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Basketball Scouting Game</title>
    <style>
        :root { --accent: #2563eb; --dark: #0f172a; --panel: #1e293b; --text: #f8fafc; }
        body { margin: 0; background: #000; color: var(--text); font-family: 'Segoe UI', system-ui, sans-serif; overflow: hidden; user-select: none; }
        
        /* UI LAYOUT */
        .screen { position: absolute; inset: 0; display: none; flex-direction: column; }
        .screen.active { display: flex; animation: fade 0.3s ease-out; }
        @keyframes fade { from {opacity:0} to {opacity:1} }

        /* SCOREBOARD (TV STYLE) */
        .tv-overlay {
            position: absolute; bottom: 40px; left: 60px; display: flex; align-items: flex-end; gap: 0;
            font-family: 'Arial Narrow', sans-serif; font-weight: bold; pointer-events: none;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.5));
        }
        .tv-team { background: #fff; color: #000; padding: 10px 25px; height: 40px; display: flex; align-items: center; font-size: 24px; border-right: 1px solid #ccc; }
        .tv-score { background: #000; color: #fff; padding: 10px 20px; height: 40px; display: flex; align-items: center; font-size: 28px; font-family: monospace; }
        .tv-logo { background: var(--accent); color: white; padding: 5px 15px; font-size: 12px; height: 20px; display: flex; align-items: center; letter-spacing: 1px; }
        .tv-time { background: #222; color: #ccc; padding: 10px 20px; height: 40px; display: flex; align-items: center; font-size: 20px; border-left: 2px solid #444; }

        /* MENU STYLES */
        #screen-menu { background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('https://images.unsplash.com/photo-1546519638-68e109498ffc?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80'); background-size: cover; align-items: center; justify-content: center; }
        .hero-title { font-size: 70px; font-weight: 900; margin-bottom: 10px; text-transform: uppercase; letter-spacing: -2px; text-shadow: 0 4px 20px black; text-align: center; }
        .menu-btn { background: rgba(0,0,0,0.6); border: 2px solid white; color: white; padding: 15px 50px; font-size: 18px; font-weight: 900; margin: 10px; cursor: pointer; transition: 0.2s; width: 350px; text-transform: uppercase; backdrop-filter: blur(5px); }
        .menu-btn:hover { background: white; color: black; transform: scale(1.05); }

        /* PAUSE MENU & BOX SCORE */
        .pause-menu { position: absolute; inset: 0; background: rgba(15, 23, 42, 0.98); z-index: 200; display: none; flex-direction: column; align-items: center; justify-content: center; }
        .pause-menu.active { display: flex; }
        
        .box-score-container { width: 80%; max-width: 900px; background: #1e293b; border-radius: 8px; padding: 20px; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .box-table { width: 100%; border-collapse: collapse; font-size: 14px; }
        .box-table th { text-align: left; border-bottom: 2px solid #334155; padding: 10px; color: #94a3b8; text-transform: uppercase; font-size: 11px; }
        .box-table td { padding: 12px 10px; border-bottom: 1px solid #334155; }
        .box-table tr:last-child td { border: none; }
        .stat-num { font-family: monospace; font-weight: bold; color: white; }
        
        .tab-bar { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab-btn { background: transparent; color: #64748b; border: none; font-weight: bold; cursor: pointer; padding: 10px; text-transform: uppercase; }
        .tab-btn.active { color: white; border-bottom: 2px solid var(--accent); }

        /* NOTIFICATIONS */
        .notify { position: absolute; top: 100px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); padding: 15px 40px; border-radius: 50px; font-weight: bold; font-size: 24px; opacity: 0; transition: 0.3s; pointer-events: none; border: 1px solid #444; }
        .pause-btn { position: absolute; top: 20px; right: 20px; width: 40px; height: 40px; background: rgba(0,0,0,0.8); border: 1px solid white; color: white; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; pointer-events: auto; }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.150.1/three.min.js"></script>
</head>
<body>

    <div id="screen-menu" class="screen active">
        <div class="hero-title">BASKETBALL<br><span style="color:var(--accent)">SCOUTING GAME</span></div>
        <div style="margin-bottom:40px; font-size:14px; letter-spacing:4px; font-weight:bold; opacity:0.8;">BROADCAST SIMULATION ENGINE</div>
        <button class="menu-btn" onclick="startGame()">Play Game</button>
        <button class="menu-btn" onclick="alert('Roster Editor coming in DLC!')">Manage Rosters</button>
    </div>

    <div id="screen-game" class="screen">
        <div class="tv-overlay">
            <div class="tv-logo">LIVE</div>
            <div class="tv-team" style="border-left: 1px solid #ccc;">HOME</div>
            <div class="tv-score" id="score-h">0</div>
            <div class="tv-team">AWAY</div>
            <div class="tv-score" id="score-a">0</div>
            <div class="tv-time" id="game-clock">8:00</div>
        </div>

        <div class="notify" id="notification">OUT OF BOUNDS</div>
        <button class="pause-btn" onclick="togglePause()">II</button>

        <div id="pause-menu" class="pause-menu">
            <h2 style="margin-bottom:20px; letter-spacing:2px; text-transform:uppercase;">Pause Menu</h2>
            
            <div class="tab-bar">
                <button class="tab-btn active" onclick="switchTab('box')">Box Score</button>
                <button class="tab-btn" onclick="switchTab('cam')">Camera</button>
            </div>

            <div id="tab-box" class="box-score-container">
                <h3 style="margin-top:0; color:var(--accent)">Home Team</h3>
                <table class="box-table" id="table-home">
                    <thead><tr><th>Player</th><th>PTS</th><th>REB</th><th>AST</th></tr></thead>
                    <tbody></tbody>
                </table>
                <h3 style="margin-top:20px; color:#ef4444">Away Team</h3>
                <table class="box-table" id="table-away">
                    <thead><tr><th>Player</th><th>PTS</th><th>REB</th><th>AST</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>

            <div style="display:flex; gap:20px; margin-top:20px;">
                <button class="menu-btn" onclick="togglePause()">Resume</button>
                <button class="menu-btn" onclick="location.reload()">Quit</button>
            </div>
        </div>
    </div>

    <script>
        // --- 1. GAME STATE ---
        const Game = {
            active: false, paused: false, clock: 480, possession: 'home',
            score: { h:0, a:0 },
            cameraMode: 'broadcast',
            state: 'play', // play, inbound, dead
            teams: {
                home: { name: 'Bruzz', color: 0x2563eb, roster: [] },
                away: { name: 'Opps', color: 0xef4444, roster: [] }
            }
        };

        // Roster Gen
        function genRoster(prefix) {
            return Array.from({length:5}).map((_,i) => ({
                id: prefix+i, name: `${prefix.toUpperCase()} #${i}`, 
                h: 70+Math.random()*10, stats: {pts:0, reb:0, ast:0}
            }));
        }
        Game.teams.home.roster = genRoster('home');
        Game.teams.away.roster = genRoster('away');

        // --- 2. THREE.JS SETUP ---
        let scene, camera, renderer, ballMesh, hoopBounds = [];
        let actors = []; // Player Mesh + Logic
        const keys = {};

        function initScene() {
            scene = new THREE.Scene(); 
            scene.background = new THREE.Color(0x111);
            scene.fog = new THREE.Fog(0x111, 60, 200);

            camera = new THREE.PerspectiveCamera(40, window.innerWidth/window.innerHeight, 0.1, 1000);
            
            renderer = new THREE.WebGLRenderer({antialias: true});
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('screen-game').appendChild(renderer.domElement);

            // STADIUM LIGHTING
            const ambient = new THREE.AmbientLight(0xffffff, 0.4);
            scene.add(ambient);
            
            const spot1 = new THREE.SpotLight(0xffffff, 1.2);
            spot1.position.set(30, 80, 20);
            spot1.castShadow = true;
            spot1.angle = 0.6;
            spot1.penumbra = 0.3;
            spot1.shadow.mapSize.set(2048, 2048);
            scene.add(spot1);

            const spot2 = new THREE.SpotLight(0xffffff, 0.5);
            spot2.position.set(-30, 80, -20);
            scene.add(spot2);

            createCourt();
            createHoops();
            spawnPlayers();
            spawnBall();
        }

        function createCourt() {
            // Procedural Glossy Floor
            const canvas = document.createElement('canvas'); canvas.width = 1024; canvas.height = 2048;
            const ctx = canvas.getContext('2d');
            
            // Wood Grain
            ctx.fillStyle = '#dcb388'; ctx.fillRect(0,0,1024,2048);
            ctx.fillStyle = 'rgba(100,50,0,0.04)'; 
            for(let i=0; i<2048; i+=4) ctx.fillRect(0,i,1024,2); 

            // Markings
            const paintColor = '#1e3a8a'; 
            const lineColor = 'white';
            const W=1024, H=2048;
            
            // Paint Areas
            ctx.fillStyle = paintColor;
            ctx.fillRect(W/2-150, 0, 300, 380); // Top Key
            ctx.fillRect(W/2-150, H-380, 300, 380); // Bottom Key
            
            // Lines
            ctx.strokeStyle = lineColor; ctx.lineWidth = 15;
            ctx.strokeRect(50, 50, W-100, H-100); // Bounds
            ctx.beginPath(); ctx.moveTo(50, H/2); ctx.lineTo(W-50, H/2); ctx.stroke(); // Half court
            ctx.beginPath(); ctx.arc(W/2, H/2, 120, 0, Math.PI*2); ctx.stroke(); // Center circle
            
            // 3PT Arcs
            ctx.beginPath(); ctx.arc(W/2, 110, 450, 0, Math.PI); ctx.stroke();
            ctx.beginPath(); ctx.arc(W/2, H-110, 450, Math.PI, 0); ctx.stroke();

            const tex = new THREE.CanvasTexture(canvas);
            tex.anisotropy = 16;

            const geo = new THREE.PlaneGeometry(50, 94);
            const mat = new THREE.MeshStandardMaterial({
                map: tex, roughness: 0.2, metalness: 0.1 // Glossy finish
            });
            const mesh = new THREE.Mesh(geo, mat);
            mesh.rotation.x = -Math.PI/2;
            mesh.receiveShadow = true;
            scene.add(mesh);
        }

        function createHoops() {
            const matPole = new THREE.MeshStandardMaterial({color:0x111, roughness:0.5});
            const matRim = new THREE.MeshStandardMaterial({color:0xff4500});
            const matNet = new THREE.MeshBasicMaterial({color:0xffffff, wireframe:true, transparent:true, opacity:0.5});
            
            const make = (z, rot) => {
                const g = new THREE.Group();
                const p = new THREE.Mesh(new THREE.CylinderGeometry(0.3, 0.3, 14), matPole);
                p.position.y = 7; 
                
                const board = new THREE.Mesh(new THREE.BoxGeometry(6, 4, 0.2), new THREE.MeshPhysicalMaterial({
                    color: 0xffffff, transmission: 0.9, opacity: 1, transparent: true, roughness: 0, thickness: 0.5
                }));
                board.position.set(0, 13, 1.5);

                const rim = new THREE.Mesh(new THREE.TorusGeometry(1.5, 0.1, 16, 16), matRim);
                rim.rotation.x = Math.PI/2; rim.position.set(0, 11, 3);
                
                const net = new THREE.Mesh(new THREE.CylinderGeometry(1.5, 1.0, 2, 16, 2, true), matNet);
                net.position.set(0, 10, 3);

                // Invisible collider for ball physics
                const collider = new THREE.Mesh(new THREE.BoxGeometry(6, 4, 1), new THREE.MeshBasicMaterial({visible:false}));
                collider.position.set(0,13,1);
                hoopBounds.push({mesh: collider, z: z, rimY: 11, side: z>0?'away':'home'});

                g.add(p, board, rim, net, collider);
                g.position.z = z; g.rotation.y = rot;
                scene.add(g);
            };

            make(-48, 0);   // Home Basket
            make(48, Math.PI); // Away Basket
        }

        function spawnPlayers() {
            const geo = new THREE.CapsuleGeometry(1, 3.5, 4, 8); // Body
            const headGeo = new THREE.SphereGeometry(0.7, 16, 16); // Head

            const spawn = (teamData, zSide) => {
                teamData.roster.forEach((p, i) => {
                    const g = new THREE.Group();
                    const mat = new THREE.MeshStandardMaterial({color: teamData.color});
                    const skin = new THREE.MeshStandardMaterial({color: 0x8d5524}); // Skin tone

                    const body = new THREE.Mesh(geo, mat);
                    body.position.y = 2.5; body.castShadow = true;
                    
                    const head = new THREE.Mesh(headGeo, skin);
                    head.position.y = 5.2; head.castShadow = true;

                    // Arms (Simple)
                    const arm = new THREE.Mesh(new THREE.CapsuleGeometry(0.3, 2.5), skin);
                    arm.position.set(1.3, 3.5, 0); arm.rotation.z = -0.2;
                    const arm2 = arm.clone(); arm2.position.set(-1.3, 3.5, 0); arm2.rotation.z = 0.2;

                    g.add(body, head, arm, arm2);
                    
                    // Position
                    g.position.set((i-2)*5, 0, zSide + (i%2)*3);
                    scene.add(g);

                    actors.push({
                        mesh: g, data: p, team: teamData.name, 
                        isUser: (teamData.name==='Bruzz' && i===0), // Player 1 is User
                        cooldown: 0
                    });
                });
            };

            spawn(Game.teams.home, 15);
            spawn(Game.teams.away, -15);
        }

        function spawnBall() {
            ballMesh = new THREE.Mesh(new THREE.SphereGeometry(0.8), new THREE.MeshStandardMaterial({color:'orange', roughness: 0.4}));
            ballMesh.castShadow = true;
            scene.add(ballMesh);
            Game.ball = { pos: new THREE.Vector3(0,5,0), vel: new THREE.Vector3(), owner: actors[0] }; // Give to user
        }

        // --- 3. PHYSICS & LOGIC ---
        function updatePhysics() {
            const ball = Game.ball;
            const bMesh = ballMesh;

            if (ball.owner) {
                // Dribbling
                const p = ball.owner.mesh.position;
                bMesh.position.set(p.x, 2.5 + Math.sin(Date.now()*0.015)*2, p.z + 1.5);
                ball.vel.set(0,0,0);
            } else {
                // Free Ball Physics
                bMesh.position.add(ball.vel);
                ball.vel.y -= 0.025; // Gravity
                ball.vel.multiplyScalar(0.99); // Air Drag

                // Floor Bounce
                if (bMesh.position.y < 0.8) {
                    bMesh.position.y = 0.8;
                    ball.vel.y *= -0.75; // Dampening
                    ball.vel.x *= 0.95; // Friction
                    ball.vel.z *= 0.95;
                }

                // Backboard Collision
                hoopBounds.forEach(h => {
                    const dz = bMesh.position.z - h.mesh.getWorldPosition(new THREE.Vector3()).z;
                    if(Math.abs(dz) < 2 && Math.abs(bMesh.position.x) < 3 && bMesh.position.y > 10) {
                        ball.vel.z *= -0.8; // Bank shot
                        ball.vel.x += (Math.random()-0.5)*0.2;
                    }
                });

                // SCORING LOGIC
                if (bMesh.position.y > 9.5 && bMesh.position.y < 10.5 && Math.abs(bMesh.position.x) < 1.5 && Math.abs(ball.vel.y) > 0) {
                    // Let's assume +Z is Home Hoop, -Z is Away Hoop.
                    if (bMesh.position.z > 43) scoreBasket('away'); // Scored in positive hoop
                    if (bMesh.position.z < -43) scoreBasket('home'); // Scored in negative hoop
                }

                // CATCH LOGIC
                if (Game.state !== 'inbound') {
                    actors.forEach(a => {
                        if (a.cooldown <= 0 && a.mesh.position.distanceTo(bMesh.position) < 2.5) {
                            ball.owner = a;
                            // Rebound stat?
                            if(bMesh.position.y > 6) a.data.stats.reb++;
                        }
                    });
                }
            }

            // OUT OF BOUNDS
            if (Math.abs(bMesh.position.x) > 25 || Math.abs(bMesh.position.z) > 47) {
                notify("OUT OF BOUNDS");
                resetInbound();
            }
        }

        function scoreBasket(scoringTeam) {
            if(Game.state === 'dead') return;
            Game.state = 'dead';
            
            // Update Score & Stats
            if(scoringTeam === 'home') Game.score.h += 2; else Game.score.a += 2;
            document.getElementById('score-h').innerText = Game.score.h;
            document.getElementById('score-a').innerText = Game.score.a;
            
            // Assist?
            if(Game.lastPasser) Game.lastPasser.data.stats.ast++;
            // Points? (Whoever shot it)
            if(Game.shooter) Game.shooter.data.stats.pts += 2;

            notify("BUCKET!");
            
            setTimeout(() => {
                // Inbound Logic: Opposing team gets ball at baseline
                resetInbound(scoringTeam === 'home' ? 'away' : 'home');
            }, 2000);
        }

        function resetInbound(possessionTeam) {
            Game.state = 'inbound';
            Game.ball.vel.set(0,0,0);
            
            // Find an inbounder
            const inbounder = actors.find(a => a.team === (possessionTeam === 'home' ? 'Bruzz' : 'Opps'));
            if(inbounder) {
                Game.ball.owner = inbounder;
                // Move inbounder to baseline
                inbounder.mesh.position.set(0, 0, possessionTeam==='home' ? 46 : -46); 
                inbounder.cooldown = 0;
            }
            setTimeout(() => { Game.state = 'play'; notify("PLAY BALL"); }, 1000);
        }

        // --- 4. GAME LOOP ---
        function startGame() {
            document.getElementById('screen-menu').classList.remove('active');
            document.getElementById('screen-game').classList.add('active');
            Game.active = true;
            initScene();
            animate();
            setInterval(updateClock, 1000);
        }

        function updateClock() {
            if(!Game.active || Game.paused || Game.clock <= 0) return;
            Game.clock--;
            const m = Math.floor(Game.clock / 60);
            const s = Game.clock % 60;
            document.getElementById('game-clock').innerText = `${m}:${s<10?'0':''}${s}`;
        }

        function animate() {
            if (!Game.active) return;
            requestAnimationFrame(animate);
            if (Game.paused) return;

            // Player Moves
            const user = actors.find(a => a.isUser);
            if (user) {
                const spd = keys.shift ? 0.3 : 0.15;
                if (keys.ArrowUp) user.mesh.position.z -= spd;
                if (keys.ArrowDown) user.mesh.position.z += spd;
                if (keys.ArrowLeft) user.mesh.position.x -= spd;
                if (keys.ArrowRight) user.mesh.position.x += spd;
                
                // Camera Follow (Broadcast Style)
                if (Game.cameraMode === 'broadcast') {
                    camera.position.x += (30 + user.mesh.position.x * 0.1 - camera.position.x) * 0.05;
                    camera.position.z += (user.mesh.position.z * 0.5 - camera.position.z) * 0.05;
                    camera.lookAt(user.mesh.position.x, 0, user.mesh.position.z);
                }
            }

            // AI (Simple)
            actors.forEach(a => {
                if (a.isUser) return;
                // If I have ball, move to hoop
                if(Game.ball.owner === a) {
                    const targetZ = a.team === 'Bruzz' ? -41 : 41;
                    a.mesh.position.z += (targetZ - a.mesh.position.z) * 0.005;
                }
            });

            updatePhysics();
            renderer.render(scene, camera);
        }

        // --- 5. INPUT & UI ---
        window.addEventListener('keydown', e => {
            if(e.key === 'Escape') togglePause();
            if(e.key === ' ') shoot();
            if(e.key.startsWith('Arrow')) keys[e.key] = true;
            if(e.key === 'Shift') keys.shift = true;
        });
        window.addEventListener('keyup', e => {
            if(e.key.startsWith('Arrow')) keys[e.key] = false;
            if(e.key === 'Shift') keys.shift = false;
        });

        function shoot() {
            const user = actors.find(a => a.isUser);
            if(Game.ball.owner === user) {
                Game.ball.owner = null;
                Game.shooter = user;
                const hoopZ = user.mesh.position.z > 0 ? 43 : -43; // Aim at opposite
                const dx = 0 - user.mesh.position.x;
                const dz = hoopZ - user.mesh.position.z;
                
                Game.ball.vel.set(dx*0.04, 0.8, dz*0.04); // Arc
            }
        }

        function togglePause() {
            Game.paused = !Game.paused;
            const menu = document.getElementById('pause-menu');
            menu.classList.toggle('active', Game.paused);
            if(Game.paused) updateBoxScore();
        }

        function notify(msg) {
            const el = document.getElementById('notification');
            el.innerText = msg; el.style.opacity = 1;
            setTimeout(() => el.style.opacity = 0, 2000);
        }

        function updateBoxScore() {
            const tbodyH = document.querySelector('#table-home tbody');
            const tbodyA = document.querySelector('#table-away tbody');
            tbodyH.innerHTML = ''; tbodyA.innerHTML = '';

            const fill = (p, tbody) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${p.name}</td><td class="stat-num">${p.stats.pts}</td><td class="stat-num">${p.stats.reb}</td><td class="stat-num">${p.stats.ast}</td>`;
                tbody.appendChild(tr);
            };

            Game.teams.home.roster.forEach(p => fill(p, tbodyH));
            Game.teams.away.roster.forEach(p => fill(p, tbodyA));
        }

        function switchTab(id) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            // Simplified for brevity - in full app would toggle divs
        }
    </script>
</body>
</html>
