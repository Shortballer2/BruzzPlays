<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Basketball Scouting Game</title>
    <style>
        :root { --blue: #3b82f6; --red: #ef4444; --dark: #0f172a; --panel: #1e293b; --text: #f8fafc; }
        body { margin: 0; background: #000; color: var(--text); font-family: 'Segoe UI', sans-serif; overflow: hidden; user-select: none; }
        
        /* --- SCREENS --- */
        .screen { position: absolute; inset: 0; display: none; flex-direction: column; }
        .screen.active { display: flex; animation: fade 0.3s ease-out; }
        @keyframes fade { from {opacity:0} to {opacity:1} }

        /* --- 1. MAIN MENU SCREEN --- */
        #screen-menu { 
            background: linear-gradient(135deg, #0f172a 0%, #000000 100%); 
            align-items: center; justify-content: center;
        }
        .hero-title { font-size: 60px; font-weight: 900; letter-spacing: -1px; line-height: 1; margin-bottom: 15px; text-shadow: 0 0 40px rgba(59, 130, 246, 0.4); text-transform: uppercase; text-align: center; }
        .hero-subtitle { color: #64748b; font-size: 14px; letter-spacing: 4px; margin-bottom: 60px; font-weight: 700; }
        
        .menu-btn {
            background: transparent; border: 1px solid rgba(255,255,255,0.1); 
            color: white; padding: 15px 60px; font-size: 18px; font-weight: 700; 
            margin: 10px; cursor: pointer; transition: 0.2s; width: 320px; text-align: center;
            text-transform: uppercase; letter-spacing: 1px;
        }
        .menu-btn:hover { background: white; color: black; transform: scale(1.05); }
        .menu-btn.primary { background: var(--blue); border-color: var(--blue); }
        .menu-btn.primary:hover { background: #2563eb; color: white; }

        /* --- 2. GM DASHBOARD --- */
        #screen-gm { background: #111; flex-direction: row; }
        
        /* Sidebar */
        .gm-sidebar { width: 300px; background: #0f1115; border-right: 1px solid #222; padding: 20px; display: flex; flex-direction: column; }
        .gm-header { font-size: 12px; font-weight: bold; color: #555; margin-bottom: 15px; text-transform: uppercase; }
        
        .team-card { 
            padding: 15px; background: #18181b; border: 1px solid #222; margin-bottom: 10px; 
            cursor: pointer; border-radius: 6px; display: flex; align-items: center; gap: 10px;
        }
        .team-card:hover { background: #27272a; }
        .team-card.active { border-color: var(--blue); background: #1e293b; }
        .color-dot { width: 12px; height: 12px; border-radius: 50%; }

        /* Main Content */
        .gm-content { flex: 1; padding: 40px; overflow-y: auto; display: flex; gap: 40px; }
        
        /* Roster Table */
        .roster-panel { flex: 1; max-width: 600px; }
        .player-row { 
            display: flex; justify-content: space-between; padding: 12px; 
            border-bottom: 1px solid #222; cursor: pointer; color: #94a3b8;
        }
        .player-row:hover { background: #1a1a1a; color: white; }
        .player-row.active { color: var(--blue); font-weight: bold; }
        
        /* Editor Panel */
        .editor-panel { width: 350px; background: #18181b; padding: 25px; border-radius: 8px; border: 1px solid #333; height: fit-content; display: none; }
        .editor-panel.active { display: block; }
        
        input[type=text], input[type=number] { 
            background: #000; border: 1px solid #333; color: white; padding: 8px; width: 100%; margin-bottom: 15px; 
        }
        label { display: block; font-size: 11px; color: #666; margin-bottom: 5px; text-transform: uppercase; font-weight: bold; }
        .stat-slider { width: 100%; margin-bottom: 15px; accent-color: var(--blue); cursor: pointer; }

        /* --- 3. GAMEPLAY SCREEN --- */
        #screen-game { background: #000; }
        canvas { display: block; width: 100%; height: 100%; }
        
        .game-ui { position: absolute; inset: 0; pointer-events: none; }
        .scoreboard { 
            position: absolute; top: 0; left: 50%; transform: translateX(-50%);
            display: flex; background: #111; padding: 10px 40px; border-radius: 0 0 10px 10px; gap: 40px;
            border-bottom: 3px solid var(--blue);
        }
        .score-team { text-align: center; }
        .score-val { font-size: 30px; font-weight: 800; font-family: monospace; }
        
        .pause-menu {
            position: absolute; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px);
            display: none; align-items: center; justify-content: center; flex-direction: column; pointer-events: auto;
        }
        .pause-menu.active { display: flex; }

        /* UTIL */
        .back-btn { position: absolute; top: 20px; left: 20px; cursor: pointer; font-weight: bold; color: #666; font-size: 14px; background: none; border: none; }
        .back-btn:hover { color: white; }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.150.1/three.min.js"></script>
</head>
<body>

    <div id="screen-menu" class="screen active">
        <div class="hero-title">BASKETBALL<br><span style="color:var(--blue)">SCOUTING GAME</span></div>
        <div class="hero-subtitle">STRATEGY & SIMULATION ENGINE</div>
        
        <button class="menu-btn primary" onclick="nav('gm')">GM Dashboard</button>
        <button class="menu-btn" onclick="startMatchup()">Play Now</button>
        <button class="menu-btn" onclick="alert('Settings Saved')">Settings</button>
    </div>

    <div id="screen-gm" class="screen">
        <button class="back-btn" onclick="nav('menu')">‚Üê MAIN MENU</button>
        
        <div class="gm-sidebar" style="padding-top: 60px;">
            <div class="gm-header">My League</div>
            <div id="team-list-container"></div>
            <button onclick="addTeam()" style="margin-top:10px; background: #222; border: 1px dashed #444; color: #888; padding: 10px; cursor: pointer;">+ Create Team</button>
        </div>

        <div class="gm-content">
            <div class="roster-panel" id="roster-view" style="display:none;">
                <h1 id="team-title" style="margin:0 0 20px 0; font-size: 24px;">Team Name</h1>
                <div style="display:flex; gap:10px; margin-bottom:20px;">
                    <input type="color" id="team-col-picker" style="width:40px; height:40px; border:none; cursor:pointer;" oninput="updateTeamMeta()">
                    <input type="text" id="team-name-edit" style="font-size:18px; font-weight:bold; background:none; border:none; border-bottom:1px solid #333;" oninput="updateTeamMeta()">
                </div>

                <div class="gm-header">Active Roster</div>
                <div id="roster-list"></div>
                <button onclick="addPlayer()" style="margin-top:15px; background:var(--blue); color:white; border:none; padding:10px 20px; cursor:pointer;">+ Add Player</button>
                <button onclick="deleteTeam()" style="margin-top:15px; margin-left:10px; background:#ef4444; color:white; border:none; padding:10px 20px; cursor:pointer;">Delete Team</button>
            </div>

            <div class="editor-panel" id="player-editor">
                <h2 style="margin-top:0; color:var(--blue); border-bottom:1px solid #333; padding-bottom:10px;">Edit Player</h2>
                
                <label>Name</label><input type="text" id="ed-name" oninput="savePlayer()">
                <div style="display:flex; gap:10px;">
                    <div style="flex:1"><label>Number</label><input type="number" id="ed-num" oninput="savePlayer()"></div>
                    <div style="flex:1"><label>Height (in)</label><input type="number" id="ed-h" oninput="savePlayer()"></div>
                </div>

                <div style="display:flex; gap:10px; margin-bottom:15px;">
                    <div style="flex:1"><label>Skin</label><input type="color" id="ed-skin" style="width:100%; height:30px; border:none;" oninput="savePlayer()"></div>
                    <div style="flex:1"><label>Shoes</label><input type="color" id="ed-shoe" style="width:100%; height:30px; border:none;" oninput="savePlayer()"></div>
                </div>

                <label>Speed (Movement)</label><input type="range" class="stat-slider" id="st-spd" min="40" max="99" oninput="savePlayer()">
                <label>Shooting (Accuracy)</label><input type="range" class="stat-slider" id="st-sht" min="40" max="99" oninput="savePlayer()">
                <label>Defense (IQ)</label><input type="range" class="stat-slider" id="st-def" min="40" max="99" oninput="savePlayer()">
                
                <button onclick="deletePlayer()" style="width:100%; background:#ef4444; color:white; border:none; padding:10px; margin-top:10px; cursor:pointer;">Cut Player</button>
            </div>
        </div>
    </div>

    <div id="screen-game" class="screen">
        <div class="game-ui">
            <div class="scoreboard">
                <div class="score-team">
                    <div style="font-size:10px; color:#888; font-weight:bold;">HOME</div>
                    <div class="score-val" style="color:var(--blue)" id="score-h">00</div>
                </div>
                <div class="score-team">
                    <div style="font-size:10px; color:#888; font-weight:bold;">AWAY</div>
                    <div class="score-val" style="color:var(--red)" id="score-a">00</div>
                </div>
            </div>
        </div>

        <div id="pause-menu" class="pause-menu">
            <h1 style="font-size:40px; margin-bottom:20px;">PAUSED</h1>
            <button class="menu-btn" onclick="togglePause()">Resume</button>
            <button class="menu-btn" onclick="quitGame()">Quit to Menu</button>
        </div>
    </div>

    <script>
        // --- 1. STATE & DB ---
        const NEW_PLAYER = { name: "New Rookie", num: 0, h: 75, skin: "#8d5524", shoes: "#ffffff", stats: { spd: 70, sht: 70, def: 50 } };
        
        let DB = JSON.parse(localStorage.getItem('basketball_scouting_db')) || {
            teams: [
                { id: 't1', name: 'The Bruzz', color: '#3b82f6', roster: [{...NEW_PLAYER, id:'p1', name:'My Player', stats:{spd:90,sht:85,def:80}}] },
                { id: 't2', name: 'Varsity', color: '#ef4444', roster: [{...NEW_PLAYER, id:'p2', name:'Opponent', num:23, stats:{spd:85,sht:80,def:70}}] }
            ]
        };

        let app = { screen: 'menu', activeTeam: null, activePlayer: null, gameRunning: false };
        let engine = { scene:null, camera:null, renderer:null, rigs:[], paused: false };

        // Save System
        const save = () => localStorage.setItem('basketball_scouting_db', JSON.stringify(DB));

        // --- 2. NAVIGATION ---
        function nav(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('screen-'+screenId).classList.add('active');
            app.screen = screenId;
            
            if(screenId === 'gm') renderGM();
        }

        // --- 3. GM MODE LOGIC ---
        function renderGM() {
            const list = document.getElementById('team-list-container');
            list.innerHTML = '';
            
            DB.teams.forEach(t => {
                const el = document.createElement('div');
                el.className = `team-card ${app.activeTeam === t.id ? 'active' : ''}`;
                el.innerHTML = `<div class="color-dot" style="background:${t.color}"></div> <span>${t.name}</span>`;
                el.onclick = () => { app.activeTeam = t.id; renderGM(); loadRosterView(); };
                list.appendChild(el);
            });
        }

        function loadRosterView() {
            const t = DB.teams.find(x => x.id === app.activeTeam);
            if(!t) return;
            
            document.getElementById('roster-view').style.display = 'block';
            document.getElementById('team-title').innerText = t.name;
            document.getElementById('team-name-edit').value = t.name;
            document.getElementById('team-col-picker').value = t.color;

            const list = document.getElementById('roster-list');
            list.innerHTML = '';
            
            t.roster.forEach(p => {
                const el = document.createElement('div');
                el.className = `player-row ${app.activePlayer === p.id ? 'active' : ''}`;
                el.innerHTML = `<span>#${p.num} ${p.name}</span> <span>${Math.floor(p.h/12)}'${p.h%12}"</span>`;
                el.onclick = () => { app.activePlayer = p.id; loadRosterView(); loadPlayerEditor(); };
                list.appendChild(el);
            });
        }

        function loadPlayerEditor() {
            const t = DB.teams.find(x => x.id === app.activeTeam);
            const p = t.roster.find(x => x.id === app.activePlayer);
            
            document.getElementById('player-editor').classList.add('active');
            
            setVal('ed-name', p.name); setVal('ed-num', p.num); setVal('ed-h', p.h);
            setVal('ed-skin', p.skin); setVal('ed-shoe', p.shoes);
            setVal('st-spd', p.stats.spd); setVal('st-sht', p.stats.sht); setVal('st-def', p.stats.def);
        }

        function savePlayer() {
            const t = DB.teams.find(x => x.id === app.activeTeam);
            const p = t.roster.find(x => x.id === app.activePlayer);
            
            p.name = getVal('ed-name'); p.num = parseInt(getVal('ed-num')); p.h = parseInt(getVal('ed-h'));
            p.skin = getVal('ed-skin'); p.shoes = getVal('ed-shoe');
            p.stats.spd = parseInt(getVal('st-spd')); p.stats.sht = parseInt(getVal('st-sht')); p.stats.def = parseInt(getVal('st-def'));
            
            save(); loadRosterView(); // Refresh list to show name changes
        }

        function updateTeamMeta() {
            const t = DB.teams.find(x => x.id === app.activeTeam);
            t.name = document.getElementById('team-name-edit').value;
            t.color = document.getElementById('team-col-picker').value;
            save(); renderGM(); document.getElementById('team-title').innerText = t.name;
        }

        function addTeam() { DB.teams.push({ id:'t'+Date.now(), name:'New Team', color:'#fff', roster:[] }); save(); renderGM(); }
        function deleteTeam() { DB.teams = DB.teams.filter(t=>t.id!==app.activeTeam); app.activeTeam=null; document.getElementById('roster-view').style.display='none'; save(); renderGM(); }
        function addPlayer() { 
            const t = DB.teams.find(x => x.id === app.activeTeam);
            t.roster.push({ ...NEW_PLAYER, id:'p'+Date.now(), stats:{...NEW_PLAYER.stats} });
            save(); loadRosterView();
        }
        function deletePlayer() {
            const t = DB.teams.find(x => x.id === app.activeTeam);
            t.roster = t.roster.filter(p=>p.id!==app.activePlayer);
            app.activePlayer=null; document.getElementById('player-editor').classList.remove('active');
            save(); loadRosterView();
        }

        // Helpers
        const setVal = (id,v) => document.getElementById(id).value = v;
        const getVal = (id) => document.getElementById(id).value;

        // --- 4. GAME ENGINE ---
        function startMatchup() {
            if(DB.teams.length < 2) return alert("You need at least 2 teams!");
            nav('game');
            initGame(DB.teams[0], DB.teams[1]);
        }
        
        function quitGame() {
            app.gameRunning = false;
            document.querySelector('canvas').remove(); // Cleanup
            nav('menu');
        }

        function togglePause() {
            engine.paused = !engine.paused;
            document.getElementById('pause-menu').classList.toggle('active');
        }

        function initGame(homeTeam, awayTeam) {
            app.gameRunning = true; engine.paused = false;
            
            // Setup ThreeJS
            const scene = new THREE.Scene(); scene.background = new THREE.Color(0x050505);
            scene.fog = new THREE.Fog(0x050505, 30, 120);
            
            const camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 1000);
            camera.position.set(0, 40, 60); camera.lookAt(0,0,0);
            
            const renderer = new THREE.WebGLRenderer({antialias:true});
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.getElementById('screen-game').appendChild(renderer.domElement);

            // Lights
            scene.add(new THREE.AmbientLight(0xffffff, 0.6));
            const spot = new THREE.SpotLight(0xffffff, 1); spot.position.set(20,80,40); spot.castShadow=true; 
            spot.shadow.mapSize.set(2048,2048); scene.add(spot);

            // Court
            const floor = new THREE.Mesh(new THREE.PlaneGeometry(100,100), new THREE.MeshStandardMaterial({color:0x222}));
            floor.rotation.x = -Math.PI/2; floor.position.y = -0.1; scene.add(floor);
            
            const cvs = document.createElement('canvas'); cvs.width=1024; cvs.height=2048; const ctx = cvs.getContext('2d');
            ctx.fillStyle='#dcb388'; ctx.fillRect(0,0,1024,2048);
            ctx.fillStyle='#1e3a8a'; ctx.fillRect(362,0,300,380);
            ctx.strokeStyle='white'; ctx.lineWidth=15; ctx.strokeRect(50,50,924,1948); ctx.beginPath(); ctx.arc(512,140,400,0,Math.PI); ctx.stroke();
            const tex = new THREE.CanvasTexture(cvs); tex.anisotropy=16;
            const court = new THREE.Mesh(new THREE.PlaneGeometry(50,94), new THREE.MeshStandardMaterial({map:tex}));
            court.rotation.x = -Math.PI/2; court.receiveShadow=true; scene.add(court);

            // Hoop
            const pole = new THREE.Mesh(new THREE.CylinderGeometry(0.3,0.3,14), new THREE.MeshStandardMaterial({color:0x222}));
            pole.position.set(0,7,-44); scene.add(pole);
            const rim = new THREE.Mesh(new THREE.TorusGeometry(1.5,0.1,16,16), new THREE.MeshStandardMaterial({color:'orange'}));
            rim.rotation.x = Math.PI/2; rim.position.set(0,11,-41); scene.add(rim);

            // Spawn Players
            engine.rigs = [];
            
            const spawn = (p, color, side) => {
                const grp = new THREE.Group();
                const s = p.h / 75; grp.scale.set(s,s,s);
                
                const matJ = new THREE.MeshStandardMaterial({color:color});
                const matS = new THREE.MeshStandardMaterial({color:p.skin});
                
                const torso = new THREE.Mesh(new THREE.BoxGeometry(1.5,2.4,0.8), matJ); torso.position.y=3.8; torso.castShadow=true; grp.add(torso);
                const head = new THREE.Mesh(new THREE.BoxGeometry(0.8,0.9,0.9), matS); head.position.y=5.5; head.castShadow=true; grp.add(head);
                
                // Limbs (Simple)
                const legL = new THREE.Mesh(new THREE.BoxGeometry(0.5,2,0.5), matJ); legL.position.set(-0.5,1,0); grp.add(legL);
                const legR = new THREE.Mesh(new THREE.BoxGeometry(0.5,2,0.5), matJ); legR.position.set(0.5,1,0); grp.add(legR);
                
                const z = side==='home' ? 10 : -10;
                grp.position.set((Math.random()-0.5)*20, 0, z);
                scene.add(grp);
                
                engine.rigs.push({ mesh: grp, p: p, limbs: {legL, legR} });
            };

            homeTeam.roster.forEach(p => spawn(p, homeTeam.color, 'home'));
            awayTeam.roster.forEach(p => spawn(p, awayTeam.color, 'away'));

            // Loop
            const clock = new THREE.Clock();
            const keys = {};
            window.onkeydown=e=>{ if(e.key==='Escape') togglePause(); keys[e.key.toLowerCase()]=true; };
            window.onkeyup=e=>keys[e.key.toLowerCase()]=false;

            function animate() {
                if(!app.gameRunning) return;
                requestAnimationFrame(animate);
                if(engine.paused) return;

                const dt = clock.getDelta();
                const t = Date.now()*0.001;
                
                // Controls (First Rig)
                if(engine.rigs.length>0) {
                    const u = engine.rigs[0];
                    const spd = (u.p.stats.spd/8) * dt;
                    if(keys.w) u.mesh.position.z -= spd; if(keys.s) u.mesh.position.z += spd;
                    if(keys.a) u.mesh.position.x -= spd; if(keys.d) u.mesh.position.x += spd;
                    
                    camera.position.x += (20+u.mesh.position.x*0.3 - camera.position.x)*0.1;
                    camera.position.z += (u.mesh.position.z*0.1 - camera.position.z)*0.1;
                    camera.lookAt(u.mesh.position.x, 0, u.mesh.position.z);
                }

                // Animate
                engine.rigs.forEach(r => {
                    r.limbs.legL.rotation.x = Math.sin(t*10 + r.mesh.position.x);
                    r.limbs.legR.rotation.x = Math.cos(t*10 + r.mesh.position.x);
                });

                renderer.render(scene, camera);
            }
            animate();
        }

    </script>
</body>
</html>
