<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>The Bruzz 3D: v0.4 Stable</title>
    <style> 
        body { margin: 0; overflow: hidden; background: #000; font-family: monospace; } 
        .ui-panel {
            position: absolute; top: 20px; left: 20px; width: 260px;
            background: rgba(20, 20, 30, 0.9); border: 1px solid #444;
            color: white; padding: 15px; border-radius: 8px; z-index: 100;
        }
        .slider-row { margin-bottom: 12px; }
        .slider-row label { display: flex; justify-content: space-between; font-size: 11px; margin-bottom: 4px; color: #aaa; }
        input[type=range] { width: 100%; cursor: pointer; }
    </style>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function App() {
            // --- SETTINGS STATE ---
            const [config, setConfig] = useState({ speed: 1.0, height: 1.0, iq: 50, aggression: 50 });
            
            const handleConfig = (key, e) => setConfig({...config, [key]: parseFloat(e.target.value)});

            return (
                <div>
                    {/* UI PANEL */}
                    <div className="ui-panel">
                        <h3 style={{marginTop:0, borderBottom:'1px solid #555', paddingBottom:5}}>GOD MODE v0.4</h3>
                        
                        <div className="slider-row">
                            <label><span>SPEED</span> <span>{config.speed.toFixed(1)}x</span></label>
                            <input type="range" min="0.1" max="2.0" step="0.1" value={config.speed} onChange={(e)=>handleConfig('speed',e)} />
                        </div>
                        <div className="slider-row">
                            <label><span>HEIGHT</span> <span>{config.height.toFixed(2)}m</span></label>
                            <input type="range" min="0.5" max="2.0" step="0.1" value={config.height} onChange={(e)=>handleConfig('height',e)} />
                        </div>
                        <div className="slider-row">
                            <label><span>DEFENSE IQ</span> <span>{config.iq}</span></label>
                            <input type="range" min="0" max="100" value={config.iq} onChange={(e)=>handleConfig('iq',e)} />
                        </div>
                        <div className="slider-row">
                            <label><span>AGGRESSION</span> <span>{config.aggression}</span></label>
                            <input type="range" min="0" max="100" value={config.aggression} onChange={(e)=>handleConfig('aggression',e)} />
                        </div>
                        
                        <div style={{fontSize:'10px', color:'#777', marginTop:10}}>
                            WASD to Move â€¢ Arrow Keys to Rotate Camera
                        </div>
                    </div>

                    {/* 3D ENGINE */}
                    <ThreeEngine config={config} />
                </div>
            );
        }

        // --- THE ENGINE ---
        function ThreeEngine({ config }) {
            const mountRef = useRef(null);
            const configRef = useRef(config); // To access fresh config in loop

            // Keep configRef updated without restarting the engine
            useEffect(() => { configRef.current = config; }, [config]);

            useEffect(() => {
                // 1. SCENE SETUP
                const scene = new THREE.Scene();
                scene.background = new THREE.Color(0x111827); // Dark Blue

                const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
                camera.position.set(0, 40, 60);
                camera.lookAt(0, 0, 0);

                const renderer = new THREE.WebGLRenderer({ antialias: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                mountRef.current.appendChild(renderer.domElement);

                // 2. LIGHTS (Bright & Simple)
                const ambient = new THREE.AmbientLight(0xffffff, 0.7);
                scene.add(ambient);
                const sun = new THREE.DirectionalLight(0xffffff, 0.8);
                sun.position.set(20, 50, 20);
                scene.add(sun);

                // 3. COURT
                const floorGeo = new THREE.PlaneGeometry(60, 100);
                const floorMat = new THREE.MeshLambertMaterial({ color: 0xd97736 }); // Wood color
                const floor = new THREE.Mesh(floorGeo, floorMat);
                floor.rotation.x = -Math.PI / 2;
                scene.add(floor);

                // Paint Area
                const paint = new THREE.Mesh(new THREE.PlaneGeometry(16, 19), new THREE.MeshBasicMaterial({color: 0x1e3a8a}));
                paint.rotation.x = -Math.PI/2;
                paint.position.set(0, 0.02, 35);
                scene.add(paint);

                // Hoop
                const pole = new THREE.Mesh(new THREE.CylinderGeometry(0.5,0.5,14), new THREE.MeshLambertMaterial({color:0x333}));
                pole.position.set(0, 7, 45);
                scene.add(pole);
                const rim = new THREE.Mesh(new THREE.TorusGeometry(1.5, 0.1, 8, 16), new THREE.MeshBasicMaterial({color: 'orange'}));
                rim.rotation.x = Math.PI/2; rim.position.set(0, 11, 43.5);
                scene.add(rim);

                // 4. PLAYERS
                const players = [
                    { id: 0, x: 0, z: 20, team: 'us', color: 0x3b82f6 },      // YOU (Blue)
                    { id: 1, x: -15, z: 10, team: 'us', color: 0x60a5fa },    // Teammate
                    { id: 5, x: 0, z: 15, team: 'them', color: 0xef4444 },    // Defender (Red)
                ];

                const meshes = [];
                const pGeo = new THREE.CapsuleGeometry(1, 4, 4, 8); // Capsule Shape
                
                players.forEach(p => {
                    const mat = new THREE.MeshLambertMaterial({ color: p.color });
                    const mesh = new THREE.Mesh(pGeo, mat);
                    mesh.position.set(p.x, 2, p.z);
                    scene.add(mesh);
                    // Store reference for animation
                    meshes.push({ mesh, data: p });
                });

                // BALL
                const ballMesh = new THREE.Mesh(new THREE.SphereGeometry(0.8), new THREE.MeshBasicMaterial({color: 0xff8800}));
                scene.add(ballMesh);

                // 5. INPUT HANDLING
                const keys = {};
                window.addEventListener('keydown', (e) => keys[e.key.toLowerCase()] = true);
                window.addEventListener('keyup', (e) => keys[e.key.toLowerCase()] = false);

                // 6. GAME LOOP
                let lastTime = 0;
                const animate = (time) => {
                    requestAnimationFrame(animate);
                    const dt = (time - lastTime) / 1000;
                    lastTime = time;
                    const cfg = configRef.current; // Read live sliders

                    // --- PHYSICS & LOGIC ---
                    const user = players[0];
                    const speed = 15 * cfg.speed * dt;

                    // Move User
                    if(keys['w']) user.z -= speed;
                    if(keys['s']) user.z += speed;
                    if(keys['a']) user.x -= speed;
                    if(keys['d']) user.x += speed;

                    // AI Logic
                    players.forEach(p => {
                        if(p.id === 0) return; // Skip human

                        // Defender chases human
                        if(p.team === 'them') {
                            const target = players[0];
                            // Ideal position: between player and hoop (0, 45)
                            const guardDist = 3 + (100 - cfg.aggression)/10; // High aggression = closer
                            
                            // Simple homing
                            const dx = target.x - p.x;
                            const dz = (target.z + guardDist) - p.z; // Stay slightly in front
                            
                            const reaction = (cfg.iq / 100) * 5 * dt; // IQ determines reaction speed
                            p.x += dx * reaction;
                            p.z += dz * reaction;
                        }
                    });

                    // --- UPDATE VISUALS ---
                    meshes.forEach(item => {
                        const p = item.data;
                        // Apply Scale (Height)
                        item.mesh.scale.y = cfg.height;
                        item.mesh.position.y = 2 * cfg.height; // Keep feet on ground
                        item.mesh.position.x = p.x;
                        item.mesh.position.z = p.z;
                    });

                    // Ball Follows Player 0 (Dribble)
                    ballMesh.position.x = user.x + 0.8;
                    ballMesh.position.z = user.z + 1;
                    ballMesh.position.y = (2 * cfg.height) + Math.abs(Math.sin(time * 0.008)) * 3;

                    // Camera Follow
                    camera.position.x += (user.x * 0.2 - camera.position.x) * 0.1;
                    
                    renderer.render(scene, camera);
                };
                animate(0);

                // Cleanup on unmount
                return () => {
                    if(mountRef.current) mountRef.current.innerHTML = '';
                };
            }, []);

            return <div ref={mountRef} />;
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
