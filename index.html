<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Basketball Scouting Game v10.0</title>
    <style>
        :root { --blue: #3b82f6; --red: #ef4444; --dark: #0f172a; --panel: #1e293b; --text: #f8fafc; }
        body { margin: 0; background: #000; color: var(--text); font-family: 'Segoe UI', system-ui, sans-serif; overflow: hidden; user-select: none; }
        
        /* UI LAYOUT */
        .screen { position: absolute; inset: 0; display: none; flex-direction: column; }
        .screen.active { display: flex; animation: fade 0.3s ease-out; }
        @keyframes fade { from {opacity:0} to {opacity:1} }

        /* SCOREBOARD (TV STYLE) */
        .tv-overlay {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            display: flex; align-items: flex-end; 
            font-family: 'Arial', sans-serif; font-weight: bold; pointer-events: none;
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.6));
        }
        .tv-bar { display: flex; background: #111; border-radius: 8px; overflow: hidden; border: 1px solid #333; }
        .tv-team { width: 80px; height: 50px; display: flex; align-items: center; justify-content: center; font-size: 20px; color: white; }
        .tv-score { width: 60px; height: 50px; background: #fff; color: #000; display: flex; align-items: center; justify-content: center; font-size: 32px; font-family: monospace; letter-spacing: -2px; }
        .tv-clock { background: #222; color: #ccc; padding: 0 20px; display: flex; align-items: center; font-size: 24px; font-family: monospace; border-left: 1px solid #333; }

        /* PAUSE MENU */
        .pause-menu { position: absolute; inset: 0; background: rgba(10, 10, 12, 0.95); z-index: 200; display: none; flex-direction: column; align-items: center; justify-content: center; backdrop-filter: blur(10px); }
        .pause-menu.active { display: flex; }
        .pause-title { font-size: 60px; font-weight: 900; margin-bottom: 40px; letter-spacing: 5px; text-transform: uppercase; }
        
        .menu-btn { 
            background: transparent; border: 2px solid rgba(255,255,255,0.2); color: white; 
            padding: 15px 60px; font-size: 18px; font-weight: bold; margin: 10px; cursor: pointer; 
            transition: 0.2s; width: 300px; text-transform: uppercase; letter-spacing: 1px;
        }
        .menu-btn:hover { background: white; color: black; transform: scale(1.05); }
        .menu-btn.primary { background: var(--blue); border-color: var(--blue); }

        /* NOTIFICATIONS */
        .notify { 
            position: absolute; top: 150px; left: 50%; transform: translateX(-50%); 
            font-size: 80px; font-weight: 900; font-style: italic; color: #fbbf24; 
            text-shadow: 0 5px 0px #b45309, 0 10px 20px rgba(0,0,0,0.5);
            pointer-events: none; opacity: 0; transition: transform 0.2s, opacity 0.2s;
        }
        .notify.pop { opacity: 1; transform: translateX(-50%) scale(1.2); }

        .hint { position: absolute; top: 20px; right: 20px; text-align: right; font-size: 12px; color: #888; font-family: monospace; pointer-events: none; }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.150.1/three.min.js"></script>
</head>
<body>

    <div id="screen-menu" class="screen active" style="align-items:center; justify-content:center; background: #050505;">
        <h1 style="font-size:80px; margin:0; line-height:0.9; text-align:center;">PRO<br><span style="color:var(--blue)">SCOUT</span></h1>
        <div style="margin-bottom:50px; color:#666; letter-spacing:5px;">BASKETBALL ENGINE</div>
        <button class="menu-btn primary" onclick="startGame()">PLAY GAME</button>
        <button class="menu-btn" onclick="toggleEditor()">ROSTER EDITOR</button>
    </div>

    <div id="screen-game" class="screen">
        <div class="tv-overlay">
            <div class="tv-bar">
                <div class="tv-team" style="background:var(--blue)">HM</div>
                <div class="tv-score" id="score-h">0</div>
                <div class="tv-score" id="score-a">0</div>
                <div class="tv-team" style="background:var(--red)">AW</div>
                <div class="tv-clock" id="game-clock">10:00</div>
            </div>
        </div>

        <div class="notify" id="notification">SWISH!</div>
        <div class="hint">ARROWS: Move (Screen Relative)<br>SPACE: Shoot/Steal<br>TAB: Switch Player<br>ESC: Pause</div>

        <div id="pause-menu" class="pause-menu">
            <div class="pause-title">PAUSED</div>
            <button class="menu-btn" onclick="togglePause()">RESUME</button>
            <button class="menu-btn" onclick="location.reload()">QUIT MATCH</button>
        </div>
    </div>

    <script>
        // --- 1. CONFIG & DATA ---
        const Game = {
            active: false, paused: false, clock: 600,
            score: { h: 0, a: 0 },
            teams: {
                home: { color: 0x3b82f6, roster: [] },
                away: { color: 0xef4444, roster: [] }
            }
        };

        // Generate Roster
        const createPlayer = (i) => ({ 
            id: i, h: 70+(Math.random()*10), w: 180, 
            skin: Math.random()>0.5 ? 0x8d5524 : 0x5c3a21,
            stats: { spd: 70, sht: 70, def: 50 } 
        });
        
        for(let i=0; i<5; i++) Game.teams.home.roster.push(createPlayer(i));
        for(let i=0; i<5; i++) Game.teams.away.roster.push(createPlayer(i+5));

        // --- 2. ENGINE ---
        let scene, camera, renderer;
        let actors = [], ball;
        const keys = {};

        function startGame() {
            document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
            document.getElementById('screen-game').classList.add('active');
            
            init3D();
            Game.active = true;
            loop();
        }

        function init3D() {
            scene = new THREE.Scene(); 
            scene.background = new THREE.Color(0x101014);
            scene.fog = new THREE.Fog(0x101014, 40, 120);

            // Broadcast Camera Setup
            camera = new THREE.PerspectiveCamera(40, window.innerWidth/window.innerHeight, 0.1, 1000);
            camera.position.set(0, 45, 65); 
            camera.lookAt(0, 0, 0);

            renderer = new THREE.WebGLRenderer({antialias:true});
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.getElementById('screen-game').appendChild(renderer.domElement);

            // Lights
            const amb = new THREE.AmbientLight(0xffffff, 0.6); scene.add(amb);
            const sun = new THREE.DirectionalLight(0xffffff, 1.2);
            sun.position.set(20, 60, 30); sun.castShadow = true;
            sun.shadow.mapSize.set(2048,2048); scene.add(sun);

            // Court (Reflective)
            const courtGeo = new THREE.PlaneGeometry(54, 94);
            const canvas = document.createElement('canvas'); canvas.width=512; canvas.height=1024;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#dcb388'; ctx.fillRect(0,0,512,1024); // Wood
            ctx.fillStyle = '#1e3a8a'; ctx.fillRect(176,0,160,190); ctx.fillRect(176,834,160,190); // Paint
            ctx.strokeStyle = 'white'; ctx.lineWidth=8; ctx.strokeRect(25,25,462,974); // Lines
            ctx.beginPath(); ctx.moveTo(25,512); ctx.lineTo(487,512); ctx.stroke(); // Half
            
            const tex = new THREE.CanvasTexture(canvas);
            const courtMat = new THREE.MeshStandardMaterial({map:tex, roughness:0.2, metalness:0.1});
            const court = new THREE.Mesh(courtGeo, courtMat);
            court.rotation.x = -Math.PI/2; court.receiveShadow=true;
            scene.add(court);

            // Hoops
            const makeHoop = (z, rot) => {
                const g = new THREE.Group();
                const p = new THREE.Mesh(new THREE.CylinderGeometry(0.2,0.2,14), new THREE.MeshStandardMaterial({color:0x222})); p.position.y=7; g.add(p);
                const b = new THREE.Mesh(new THREE.BoxGeometry(6,4,0.1), new THREE.MeshStandardMaterial({color:0xffffff})); b.position.set(0,13,1); g.add(b);
                const r = new THREE.Mesh(new THREE.TorusGeometry(1.5,0.1,16,16), new THREE.MeshStandardMaterial({color:'orange'})); 
                r.rotation.x=Math.PI/2; r.position.set(0,11,2.5); g.add(r);
                g.position.z=z; g.rotation.y=rot; scene.add(g);
            };
            makeHoop(-47, 0); makeHoop(47, Math.PI);

            // Ball
            ball = { mesh: new THREE.Mesh(new THREE.SphereGeometry(0.6), new THREE.MeshStandardMaterial({color:'orange'})), pos: new THREE.Vector3(0,5,0), vel: new THREE.Vector3(), owner:null };
            ball.mesh.castShadow = true; scene.add(ball.mesh);

            // Spawn Teams
            actors = [];
            spawnTeam(Game.teams.home, 'home');
            spawnTeam(Game.teams.away, 'away');
            
            // Give ball to P1 Home
            ball.owner = actors[0];
        }

        function spawnTeam(team, side) {
            team.roster.forEach((p, i) => {
                const rig = createProRig(team.color, p.skin, p.h);
                // Formation: 2-1-2
                const z = side==='home' ? 15 : -15;
                const x = (i%2 === 0 ? 1 : -1) * (i+1)*3;
                rig.mesh.position.set(x, 0, z);
                scene.add(rig.mesh);
                
                actors.push({
                    rig: rig, data: p, team: side, 
                    user: (side==='home' && i===0), // P1 is user
                    cooldown: 0
                });
            });
        }

        // --- 3. PRO RIG GENERATOR (Smooth Geometry) ---
        function createProRig(jerseyCol, skinCol, height) {
            const g = new THREE.Group();
            const s = height / 75; 
            g.scale.set(s,s,s);

            const matJ = new THREE.MeshStandardMaterial({color: jerseyCol, roughness:0.5});
            const matS = new THREE.MeshStandardMaterial({color: skinCol, roughness:0.6});
            const matShoe = new THREE.MeshStandardMaterial({color: 0xeeeeee});

            // 1. Torso (Cylinder)
            const torso = new THREE.Mesh(new THREE.CylinderGeometry(1.2, 1.0, 2.5, 12), matJ);
            torso.position.y = 4.25; torso.castShadow = true;
            
            // 2. Head (Sphere + Neck)
            const neck = new THREE.Mesh(new THREE.CylinderGeometry(0.4, 0.5, 0.8), matS);
            neck.position.y = 5.8;
            const head = new THREE.Mesh(new THREE.SphereGeometry(0.8, 16, 16), matS);
            head.position.y = 6.6;

            // 3. Legs (Thick Thighs + Calves)
            const mkLeg = (x) => {
                const leg = new THREE.Group(); leg.position.set(x, 3, 0);
                // Thigh (Shorts)
                const thigh = new THREE.Mesh(new THREE.CylinderGeometry(0.5, 0.5, 1.8), matJ);
                thigh.position.y = -0.9;
                // Calf (Skin)
                const calf = new THREE.Mesh(new THREE.CylinderGeometry(0.35, 0.25, 1.8), matS);
                calf.position.y = -2.5;
                // Shoe
                const shoe = new THREE.Mesh(new THREE.BoxGeometry(0.6, 0.5, 1.2), matShoe);
                shoe.position.set(0, -3.5, 0.2);
                leg.add(thigh, calf, shoe);
                return leg;
            };
            const legL = mkLeg(-0.6);
            const legR = mkLeg(0.6);

            // 4. Arms
            const mkArm = (x, rz) => {
                const arm = new THREE.Group(); arm.position.set(x, 5.2, 0);
                const limb = new THREE.Mesh(new THREE.CylinderGeometry(0.3, 0.25, 2.8), matS);
                limb.position.y = -1.4; limb.rotation.z = rz;
                arm.add(limb);
                return arm;
            };
            const armL = mkArm(-1.4, 0.2);
            const armR = mkArm(1.4, -0.2);

            g.add(torso, neck, head, legL, legR, armL, armR);
            return { mesh: g, anim: {legL, legR, armL, armR} };
        }

        // --- 4. GAME LOOP & LOGIC ---
        function loop() {
            if(!Game.active) return;
            requestAnimationFrame(loop);
            if(Game.paused) return;

            // Input Handling (Camera Relative)
            const user = actors.find(a => a.user);
            if(user) {
                const spd = keys.Shift ? 0.3 : 0.15;
                // Camera is at +Z looking at origin.
                // Right Arrow = +X, Up Arrow = -Z
                if(keys.ArrowRight) user.rig.mesh.position.x += spd;
                if(keys.ArrowLeft) user.rig.mesh.position.x -= spd;
                if(keys.ArrowUp) user.rig.mesh.position.z -= spd;
                if(keys.ArrowDown) user.rig.mesh.position.z += spd;

                // Camera Pan
                camera.position.x += (user.rig.mesh.position.x * 0.4 - camera.position.x) * 0.05;
                camera.position.z += ((user.rig.mesh.position.z + 40) - camera.position.z) * 0.05;
                camera.lookAt(user.rig.mesh.position.x, 0, user.rig.mesh.position.z);
            }

            // Ball Physics
            if(ball.owner) {
                const p = ball.owner.rig.mesh.position;
                ball.mesh.position.set(p.x, 3 + Math.sin(Date.now()*0.015)*2, p.z+1.5);
            } else {
                ball.mesh.position.add(ball.vel);
                ball.vel.y -= 0.03; // Gravity
                if(ball.mesh.position.y < 0.7) { 
                    ball.mesh.position.y = 0.7; ball.vel.y *= -0.7; 
                }
                
                // Wall Bounce
                if(Math.abs(ball.mesh.position.x) > 26) ball.vel.x *= -0.8;
                if(Math.abs(ball.mesh.position.z) > 48) ball.vel.z *= -0.8;

                // Score Logic (Simple Zone Check)
                if(Math.abs(ball.mesh.position.z) > 44 && Math.abs(ball.mesh.position.x) < 2 && ball.mesh.position.y > 10 && ball.vel.y < 0) {
                    showNotify("BUCKET!");
                    Game.score[ball.mesh.position.z > 0 ? 'a' : 'h'] += 2;
                    updateScore();
                    ball.vel.set(0,0,0); ball.owner = user; // Reset to user for now
                }
            }

            // Animations
            actors.forEach(a => {
                // If moving? (Check prev pos ideally, but using generic idle for now)
                a.rig.anim.legL.rotation.x = Math.sin(Date.now()*0.01 + a.rig.mesh.position.x);
                a.rig.anim.legR.rotation.x = -Math.sin(Date.now()*0.01 + a.rig.mesh.position.x);
                
                // AI Follow Ball
                if(!a.user && ball.owner && ball.owner.team !== a.team) {
                    // Defensive slide
                    a.rig.mesh.position.x += (ball.mesh.position.x - a.rig.mesh.position.x) * 0.02;
                }
            });

            renderer.render(scene, camera);
        }

        // --- 5. CONTROLS & UI ---
        window.addEventListener('keydown', e => {
            if(e.key==='Escape') togglePause();
            if(e.key===' ') shoot();
            if(e.key==='Tab') switchPlayer();
            keys[e.key] = true;
        });
        window.addEventListener('keyup', e => keys[e.key] = false);

        function shoot() {
            if(!ball.owner || !ball.owner.user) return;
            const u = ball.owner;
            ball.owner = null;
            // Aim at opposite hoop
            const hoopZ = u.rig.mesh.position.z > 0 ? 47 : -47;
            const dx = 0 - u.rig.mesh.position.x;
            const dz = hoopZ - u.rig.mesh.position.z;
            ball.vel.set(dx*0.045, 1.0, dz*0.045);
        }

        function switchPlayer() {
            // Cycle user control to next teammate
            const teamActors = actors.filter(a => a.team === 'home');
            const currentIdx = teamActors.findIndex(a => a.user);
            teamActors[currentIdx].user = false;
            teamActors[(currentIdx+1)%teamActors.length].user = true;
        }

        function updateScore() {
            document.getElementById('score-h').innerText = Game.score.h;
            document.getElementById('score-a').innerText = Game.score.a;
        }

        function showNotify(txt) {
            const n = document.getElementById('notification');
            n.innerText = txt; n.classList.add('pop');
            setTimeout(() => n.classList.remove('pop'), 1500);
        }

        function togglePause() {
            Game.paused = !Game.paused;
            document.getElementById('pause-menu').classList.toggle('active', Game.paused);
        }
        function toggleEditor() { alert("Full Editor in DLC. Use Play Now for preset rosters."); }

    </script>
</body>
</html>
